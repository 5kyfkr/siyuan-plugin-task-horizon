# 任务管理器（Task Horizon）

使用说明：
[任务管理器插件 V1.3 发布：新增日历视图，支持：看板/ 时间轴 / 表格视图 / 四象限分组 / 悬浮条快速编辑 / 任务快速新建 / 自定义优先级排序 / 番茄钟联动](https://ld246.com/article/1770607439695)

视图介绍：
[任务管理器插件 V1.5发布：支持白板视图，附时间轴、看板、日历、表格 视图使用介绍](https://ld246.com/article/1771900014059)

赞助者名单：[bigyelloworange](https://ld246.com/member/bigyelloworange) / [Floria233](https://ld246.com/member/Floria233) / [nj90hou](https://ld246.com/member/nj90hou) / [sky90038528](https://ld246.com/member/sky90038528)

# 更新记录

## 1.5.5更新内容
- **新增：设置首页增加任务内容和备注列自动换行设置，可显示更多超长任务内容**
- **新增：文档页签右键菜单增加新建任务功能，弹出快速新建任务窗口并自动选择当前文档**
- **新增：底栏番茄钟提醒的任务同步显示在日历全天事件中**
- **新增：增加设置：根据父任务按子任务时间参与排序，已过期时间离今天远>已过期时间离今天近>未过期离今天近>未过期离今天远 这样的顺序找到时间优先级最高的子任务，然后父任务根据子任务的时间依次参与按时间和四象限的分组排序，仅按时间和四象限模式下生效**
- 优化：重要性设置项使用Jira风格图标
- 优化：时间轴设置里程碑事件后，日历仅在最后完成日期的全天事件显示该任务
- 优化：大幅精简优化任务悬浮条样式，并支持更多按钮可编辑全部字段
- 优化：日历侧边栏支持显示节假日调休徽标
- 优化：表格视图状态标签外观样式
- 优化：移动端日历默认打开日视图
- 优化：快速添加任务界面支持回车键提交
- 修复：父任务完成导致深层子任务被隐藏
- 修复：按时间排序完成时间距今天计算不准确问题
- 修复：点击日历新建日程切换日历分组颜色没有对应切换问题
- 修复：快速添加界面的文档选择的默认任务文档选项异常变动
- 修复：切换页签后重新进入插件页面日程刷新闪烁且丢失滚动位置
- 修复：时间轴视图上右击后异常清除横向滚动位置
- 修复：开启日历侧边栏后表格\看板视图下无法拖拽任务至文档页签或看板问题
- 修复：日历全天事件点击更多后的异常界面跳转问题
- 修复：日历视图在页签后台时引起的布局混乱问题

## 1.5.4更新内容

- 修复：日历侧边栏无法直接点击时间轴新建日程
- 修复：开启日历侧边栏后，白板无法连线，去除白板视图卡片可以拖拽至日历侧边栏安排任务的相关逻辑
- 修复：切换到其他文档标签页再切回插件页面后，日历视图排版异常错位问题
- 修复：切换文档页签一段时间再回到插件的日历视图会刷新闪烁一次问题

## 1.5.3更新内容

- **新增：日历侧边栏，可在菜单中开启，在表格、看板视图中可直接拖拽任务至边栏安排时间**
- **新增：摘要功能，在菜单中点击摘要按钮进入，可以自定义筛选任务更新日期、文档、状态，可生成对应md格式的任务摘要清单**
- **新增：设置->文档分组与管理中新增导出按钮，可以导出分组内所有任务为Mackdown/JSON格式，用于给AI分析或数据分享**
- **新增：按任务分组模式，支持按任务内容名称列进行分组，相同任务名称的分为同一组，默认不开启，可在设置中开启**
- **新增：文档页签右键菜单增加打开文档功能，可以打开页签文档**
- **新增：时间轴视图支持Ctrl+鼠标左键多选时间轴整体拖动调节时间**
- **新增：如果任务在今天安排了日程，各视图下任务字体颜色标识为蓝色**
- 优化：顶栏的分组下拉菜单改名为文档，模式下拉菜单改名为分组
- 优化：优化时间轴强制按完成时间排序设置，开启后已过期任务排序在未过期任务前，时间轴排布不被打乱
- 优化：日历视图日程刷新闪动问题
- 优化：表头高度空隙降低，减少位置占用
- 优化：看板模式下按文档分组下支持二级标题分组
- 优化：完成时间列改名为完成日期列，与开始日期列描述统一
- 优化：优化日历侧边栏界面样式，去除多余边框按钮
- 修复：日历视图根据时长列确定拖入时长要先确实是小时还是分钟模式，跟随设置中的时长显示格式设置
- 修复：日历视图跨天事项个别日期中漏显示问题
- 修复：日历视图点击日视图周视图内半小时格子而编辑界面是1小时问题
- 修复：默认进行状态的时候无法被筛选问题
- 修复：日历视图编辑界面调整时间后，任务复选框和任务名称消失问题
- 修复：日历视图如果不在对应的文档分组下，任务无法点击完成问题
- 修复：日历视图的日、周视图会出现异常未加载空白和元素错位
- 修复：白板刚打开的前几秒无法进行连线
- 修复：任务在文档里完成后，日历视图里无法获取完成状态

<details>
<summary>历史版本更新（点击展开）</summary>

## 1.5.1更新内容

- 新增：设置->日历->日历起始日设置，可设置周日或周一为起始日
- 优化：支持鼠标悬浮在任务名称上浏览任务全部文本
- 优化：文档页签选中高亮样式优化，不遮挡进度条
- 优化：当筛选规则是“全部”或无排序规则，且模式是“按文档”的时候，任务和子任务排序与文档内任务顺序一致
- 修复：优先级设置界面编辑数值回弹至顶部问题
- 修复：重载插件后标签页重复显示

## 1.5.0更新内容

- 新增：白板视图，支持任务按自定义流程连线排布，梳理任务顺序
- 新增：看板宽度可在设置中调节
- 优化：看板视图卡片内容，父任务描述仅在子任务脱离父任务后出现，文档名称仅在全部页签下出现
- 优化：时间轴支持顺序连线并于白板视图同步
- 优化：文档分组下的标题分组排序更稳定，按文档内实际顺序展示，并兼容任务标题级别设置（h1-h6）
- 优化：移动端与窄屏下的视图切换与时间轴操作入口，菜单与顶栏按钮布局更合理

## 1.3.8更新内容

- 新增：文档分组模式下支持按二级标题列分组，让任务层级更明显[1.3.8]
- 新增：文档页签任务完成进度展示，文档页签根据根据文档任务完成和未完成数量在文档页签内绘制进度条
- 新增：文档页签钉住功能，右击文档页签，支持将文档置顶钉住至该文档分组下的页签最左侧，文档模式排序下钉住文档的任务也同时置顶
- 新增：时间轴视图支持右击时间轴，弹出的右键菜单中设置为里程碑事件，设置后仅在完成日期处标注🚩图标
- 新增：在常规设置中新增选项：看板拖动父任务时同步更改子任务状态，开启后子任务跟随父任务一同拖拽后切换看板状态
- 新增：移动端在日历视图下的插件顶栏增加`📅`按钮可以打开侧边栏，长按拖动任务的时候自动收起侧边栏界面并可以拖动至时间轴
- 新增：外观设置新增顶栏字体颜色设置，并优化顶栏下拉选项背景为透明
- 优化：看板视图增加看板宽度设置，优化日期选择器弹出窗口及卡片字样
- 优化：看板视图支持按时间、文档、四象限模式分组
- 修复：假期首尾或中间非节日当天显示全天事件的情况
- 修复：日历拖拽改时间弹窗问题
- 修复：日历全天任务拖拽跳转及错位问题

## 1.3.5更新内容

- 新增：日历视图
  - 支持查看底栏番茄钟(v1.7.7)计时数据
  - 支持任务侧边栏，直接将任务拖拽进日历视图新建日程
  - 支持日、周、月视图切换
  - 支持节假日及调休、农历显示
  - 当天日程事件时间与时间轴视图的起止时间数据分离，互不影响
- 优化：桌面端视图选择器样式优化，顶栏按钮排布优化

## 1.2.5更新内容

- 新增：看板视图，常规设置中可设置看板紧凑模式
- 新增：常规设置中新增默认视图选项，可设置打开插件默认进入的视图，注意设置默认是时间轴视图后移动端仍然打开表格视图，竖屏时间轴视图显示不全，可横屏后切换使用
- 优化：在完成状态筛选中新增“所有状态(忽略不查找已完成父任务)”，开启此项筛选后可获取所有任务，不受常规设置的“忽略不查找已完成父任务”影响

## 1.2.1更新内容

- 新增：常规设置增加行高设置
- 修复：时间轴视图行高与表格视图不同步
- 修复：已完成任务筛选规则不生效
  - 筛选规则当完成状态为是的时候，可忽略不查找已完成父任务的设置，直接搜索笔记内已完成任务
  - 修复筛选规则当完成状态为是的时候未生效问题

## 1.1.6更新内容

- 新增：文档分组、四象限分组、时间分组的分组内任务行背景使用分组颜色，可外观设置中关闭
- 新增：悬浮栏添加提醒自动识别语义中时间，并且支持无弹窗直接识别后添加，可在底栏番茄钟(1.7.5版本)插件侧边栏设置中开启
  - 支持的典型表达示例：09:30 、 9点/9点半 、 下午3点 、 今天/明天/后天 、每周/每月/每年、 2小时后/30分钟后 、 周三/下周三 、 2026-02-12 、 2/12 、 2月12日
- 新增：支持点击时间轴空白区域横向拖拽移动时间轴视图
- 新增：文档支持随机生成颜色或指定颜色，时间轴颜色按照文档颜色上色
- 新增：时间轴中已完成任务的时间轴颜色变暗、饱和度降低
- 新增：时间轴中表头周末日期，暗色区分显示
- 新增：时间轴支持双击后新建对应双击位置的完成时间
- 新增：时间轴支持右击清空起止时间
- 新增：设置 → 规则管理 → 时间轴强制按完成时间排序（越近今天越靠前），此设置仅时间轴视图生效
- 修复：时间轴编辑后刷新抖动
- 修复：部分系统手机上“完成时间/开始日期”单元格弹出日期选择器失败问题
- 优化：新增分组和子任务折叠展开动画
- 优化：列宽度最小宽度限制修改为10px，如果拖拽无法调节可在外观设置中调节宽度

## 1.1.3更新内容

- 新增：时间轴视图(甘特图)，点击顶栏时间轴按钮即可切换，在时间轴视图可直观看到任务区间范围。任务内容列宽度可独立拖拽表头调整，移动端可横屏查看
- 新增：点击左上角任务管理器字样后隐藏/展开文档页签栏
- 新增：增加开始日期列，可以在表格视图隐藏，在时间轴视图仍会展示
- 新增：外观设置表格边框颜色设置
- 修复：另一端长期未使用后同步状态导致文档分组列表清空的问题
- 优化：行高跟随字体大小自动调整
- 优化：移动端横向滚动表格时，分组名称跟随滚动可见
- 优化：开启不查找已完成父任务后，如果文档里均是已完成的父任务，则文档不显示在文档页签栏中

## 1.0.8更新内容

- 新增：四象限分组功能，设置中可设置分组规则
- 新增：子任务进度条，在任务内容列比如4个子任务完成2个，则填充0~50%位置背景色，100%则全部填充
- 新增：在按时间分组的时候，对分组下的任务时长列求和，显示在分组名称右侧，支持格式分钟或小时切换，如1.5h或90min，默认是小时格式
- 新增：在任务名称旁展示当前父任务下的子任务剩余任务数，如8个子任务已完成3个任务剩余5个，就显示5
- 新增：不查找已完成父任务功能，开启后插件仅查找未完成父任务，可提升搜索性能和长期使用性能
- 新增：分组名称行可单击后折叠/展开
- 优化：父子任务从双击折叠展开改为单击后折叠展开
- 修复：折叠展开子任务或分组的350ms操作延迟问题
- 修复：点击任务名称跳转区域，仅在任务内容文字上点击才会跳转

## 1.0.7更新内容

- 修复：思源笔记在后台切回前台不自动跳转到插件页面

## 1.0.6更新内容

- 新增：外观设置页新增“🎨 配色”面板：可分别配置亮色/夜间的顶栏渐变、任务内容列字体颜色、按文档分组标题颜色、按时间分组的基础色与已过期色

## 1.0.5更新内容

- 新增：任务所在标题列增加自定义设置，支持其他层级标题，如h1-h6，列名也跟随变化
- 修复：新建任务界面选择了其他文档后，不变动全局新建文档的设置，提升新建任务提交速度
- 修复：文档分组与管理设置在其他分组内有文档也可以不提示要添加文档，并支持删除全部文档分组下文档
- 优化：优先级算法设置界面稳定性优化
- 优化：思源笔记从后台切到前台后，不要显示加载任务中的提示
- 修复：当在分组里选择全部页签时，排序规则没有生效
- 优化：文档分组与管理设置中全部文档中无法删除已添加的文档，已可删除
- 优化：点击顶栏插件图标，如果已有已经打开的插件标签页则直接跳转到已打开插件标签页
- 优化：quickbar弹出位置往右30px

## 1.0.3

### 新增
- 首次发布。
- 多文档任务汇总视图：规则筛选、分组与排序。
- 列配置：显示/顺序/宽度可调。
- quickbar：快速编辑自定义字段（重要性/状态/完成日/时长/备注），以及置顶/提醒等快捷操作。
- 桌面端顶栏入口、移动端快速新建入口。
- 番茄钟联动（可选）：计时/提醒/耗时列。


## 1.0.7更新内容

- 新增：外观设置页新增“🎨 配色”面板：可分别配置亮色/夜间的顶栏渐变、任务内容列字体颜色、按文档分组标题颜色、按时间分组的基础色与已过期色
- 修复：思源笔记在后台切回前台不自动跳转到插件页面

## 1.0.5更新内容

- 新增：任务所在标题列增加自定义设置，支持其他层级标题，如h1-h6，列名也跟随变化
- 修复：新建任务界面选择了其他文档后，不变动全局新建文档的设置，提升新建任务提交速度
- 修复：文档分组与管理设置在其他分组内有文档也可以不提示要添加文档，并支持删除全部文档分组下文档
- 优化：优先级算法设置界面稳定性优化
- 优化：思源笔记从后台切到前台后，不要显示加载任务中的提示
- 修复：当在分组里选择全部页签时，排序规则没有生效
- 优化：文档分组与管理设置中全部文档中无法删除已添加的文档，已可删除
- 优化：点击顶栏插件图标，如果已有已经打开的插件标签页则直接跳转到已打开插件标签页
- 优化：quickbar弹出位置往右30px

## 1.0.3

- 1.0.3：首次发布

</details>

## 快速开始（首次使用必看）
1. 在思源中启用插件后刷新一次应用。
2. 打开任务管理器：
   - 桌面端：点击顶栏的任务图标（插件添加的按钮），会自动打开插件标签页。
   - 移动端：文档顶部面包屑栏右侧按钮：
     - 短按：打开“快速新建任务”
     - 长按：打开任务管理器
3. 第一次打开如果提示“请先选择要显示的文档”，点击工具栏的「⚙️ 设置」：
   - 进入「📂 文档分组与管理」
   - 复制文档 ID 添加要纳入管理的文档（也可以创建分组），(必须先在全部文档或其他新建分组内添加一个文档，不然会弹出未添加文档提示)
   - 另外选中包含子文档后插件会搜索该文档下所有有任务的文档，所以一般直接把顶层文档添加进去就可以了
   - 保存设置后回到列表，点击「🔄️」刷新即可看到任务
4. 如果任务显示不全：请前往思源笔记设置 -> 搜索 -> 搜索结果显示数，把此项数值调大至超过所有任务的数量

## 主要功能
- 多文档任务汇总：把选中文档（或分组）中的任务集中展示
- 筛选规则：支持多条件组合（包含/不包含关键词、重要性、状态等）
- 分组与视图：
  - 文档分组切换（全部文档 / 自定义分组）
  - 按文档分组、按时间分组
  - 列显示/顺序/宽度可调
- 任务悬浮条（quickbar）：点击任务块弹出面板，快速编辑自定义字段（重要性/状态/完成日/时长/备注），并提供置顶、提醒等快捷动作
- 快速新建任务：移动端短按入口直接弹出“添加待办”，可选目标文档、重要性、状态、完成日
- 底栏番茄钟插件联动（可选）：启用后提供计时/提醒/耗时列，并支持自定义耗时属性名与读取模式

## 使用方式
### 1）选择文档 / 分组
- 在列表顶部「分组」下拉框切换：全部文档或自定义分组
- 在「⚙️ 设置 → 📂 文档分组与管理」：
  - 新建分组并给分组添加文档
  - 也可以直接输入文档 ID 添加（可勾选“包含子文档”）

获取文档 ID 的方法：在思源中打开文档菜单，复制 id 得到的就是文档 ID。

### 2）创建并应用筛选规则
- 点击工具栏「⚙️ 设置 → 规则管理」新建规则
- 回到列表顶部「规则」下拉框选择规则，即可对任务列表进行筛选

### 3）搜索、分组、刷新
- 「🔍 搜索」：按关键词在当前列表中过滤
- 「按文档分组 / 按时间分组」勾选项：控制列表呈现方式
- 「🔄️」：重新加载并刷新列表

### 4）编辑任务（quickbar）
前提：在「⚙️ 设置 → 常规设置」启用“任务悬浮条（quickbar）”。

点击任务块后会弹出悬浮条，可快速编辑这些字段：
- ⭐ 重要性：高 / 中 / 低 / 无
- 🏷 状态：来自“状态选项设置”（可自定义）
- 🗓 完成日：自定义完成日期
- ⏱ 时长：自定义时长字段
- 📝 备注：自定义备注字段

## 配置说明（⚙️ 设置）
设置面板分为 4 个标签页：

### 常规设置
- 查询限制：每个文档最多加载多少条任务
- 字体大小：桌面端与移动端分别可设置
- 任务悬浮条（quickbar）：
  - 启用/关闭 quickbar
  - 新建任务默认置顶
- 番茄钟联动：
  - 启用/关闭 tomato.js 相关功能（计时/提醒/耗时列）
  - 耗时读取模式：分钟属性 / 小时属性
  - 耗时属性名：对应思源区块属性 name（例如 `custom-tomato-minutes`）
- 全局新建文档位置设置：
  - 配置“快速新建任务”默认写入的目标文档（也可选择“今天日记”）
  - 支持下拉选择或直接输入文档 ID
- 状态选项设置：
  - 自定义状态的 id / 名称 / 颜色
  - 悬浮条的“状态”下拉会实时使用这些选项
- 文档分组与管理：
  - 新建/切换分组
  - 向分组添加文档（支持包含子文档）

### 外观
- 列设置（显示/排序/宽度）：
  - 勾选显示/隐藏列
  - ↑↓ 调整列顺序
  - 滑块调整列宽

可用列（示例）：置顶、任务内容、状态、优先级、文档、二级标题、重要性、完成时间、时长、耗时、备注。

### 规则管理
- 维护筛选规则列表（新建/编辑/删除）
- 规则支持多条件组合筛选，用于从大量任务中快速定位目标

### 优先级算法
- 用于计算列表中的“优先级/得分”列
- 可按你的习惯调整权重与加减分规则，然后保存生效

## 数据存储与同步
- 插件数据保存在本地工作空间的插件存储中，并带本地缓存；插件本身不负责云端同步。

## 常见问题
### 为什么打开后没有任务？
- 首次使用必须先在「⚙️ 设置 → 文档分组与管理」添加至少一个文档；否则会提示“请先选择要显示的文档”。

## 致谢
- dhtmlxGantt：时间轴视图开发
- FullCalendar：日历视图开发
- holiday.ailcc.com：日历节假日api
