# 任务管理器（Task Horizon）

任务管理器插件：把分散在多个文档中的任务汇总成可筛选、可分组、可排序的列表，并提供悬浮条（quickbar）来快速编辑任务的自定义字段。

## 版本记录
- 1.0.1：首次发布

## 快速开始（首次使用必看）
1. 在思源中启用插件后刷新一次应用。
2. 打开任务管理器：
   - 桌面端：点击顶栏的任务图标（插件添加的按钮），会自动打开插件标签页。
   - 移动端：文档顶部面包屑栏右侧按钮：
     - 短按：打开“快速新建任务”
     - 长按：打开任务管理器
3. 第一次打开如果提示“请先选择要显示的文档”，点击工具栏的「⚙️ 设置」：
   - 进入「📂 文档分组与管理」
   - 添加要纳入管理的文档（也可以创建分组）
   - 保存设置后回到列表，点击「🔄️」刷新即可看到任务
4. 如果任务显示不全：请前往思源笔记设置->搜索->搜索结果显示数，把此项数值调大至超过所有任务的数量

## 主要功能
- 多文档任务汇总：把选中文档（或分组）中的任务集中展示
- 筛选规则：支持多条件组合（包含/不包含关键词、重要性、状态等）
- 分组与视图：
  - 文档分组切换（全部文档 / 自定义分组）
  - 按文档分组、按时间分组
  - 列显示/顺序/宽度可调
- 任务悬浮条（quickbar）：点击任务块弹出面板，快速编辑自定义字段（重要性/状态/完成日/时长/备注），并提供置顶、提醒等快捷动作
- 快速新建任务：移动端短按入口直接弹出“添加待办”，可选目标文档、重要性、状态、完成日
- 底栏番茄钟插件联动（可选）：启用后提供计时/提醒/耗时列，并支持自定义耗时属性名与读取模式

## 使用方式
### 1）选择文档 / 分组
- 在列表顶部「分组」下拉框切换：全部文档或自定义分组
- 在「⚙️ 设置 → 📂 文档分组与管理」：
  - 新建分组并给分组添加文档
  - 也可以直接输入文档 ID 添加（可勾选“包含子文档”）

获取文档 ID 的方法：在思源中打开文档菜单，复制id 得到的就是文档 ID。

### 2）创建并应用筛选规则
- 点击工具栏「⚙️ 设置 → 规则管理」新建规则
- 回到列表顶部「规则」下拉框选择规则，即可对任务列表进行筛选

### 3）搜索、分组、刷新
- 「🔍 搜索」：按关键词在当前列表中过滤
- 「按文档分组 / 按时间分组」勾选项：控制列表呈现方式
- 「🔄️」：重新加载并刷新列表

### 4）编辑任务（quickbar）
前提：在「⚙️ 设置 → 常规设置」启用“任务悬浮条（quickbar）”。

点击任务块后会弹出悬浮条，可快速编辑这些字段：
- ⭐ 重要性：高 / 中/ 低 / 无
- 🏷 状态：来自“状态选项设置”（可自定义）
- 🗓 完成日：自定义完成日期
- ⏱ 时长：自定义时长字段
- 📝 备注：自定义备注字段

## 配置说明（⚙️ 设置）
设置面板分为 4 个标签页：

### 常规设置
- 查询限制：每个文档最多加载多少条任务
- 字体大小：桌面端与移动端分别可设置
- 任务悬浮条（quickbar）：
  - 启用/关闭 quickbar
  - 新建任务默认置顶
- 番茄钟联动：
  - 启用/关闭 tomato.js 相关功能（计时/提醒/耗时列）
  - 耗时读取模式：分钟属性 / 小时属性
  - 耗时属性名：对应思源区块属性 name（例如 `custom-tomato-minutes`）
- 全局新建文档位置设置：
  - 配置“快速新建任务”默认写入的目标文档（也可选择“今天日记”）
  - 支持下拉选择或直接输入文档 ID
- 状态选项设置：
  - 自定义状态的 id / 名称 / 颜色
  - 悬浮条的“状态”下拉会实时使用这些选项
- 文档分组与管理：
  - 新建/切换分组
  - 向分组添加文档（支持包含子文档）

### 外观
- 列设置（显示/排序/宽度）：
  - 勾选显示/隐藏列
  - ↑↓ 调整列顺序
  - 滑块调整列宽

可用列（示例）：置顶、任务内容、状态、优先级、文档、二级标题、重要性、完成时间、时长、耗时、备注。

### 规则管理
- 维护筛选规则列表（新建/编辑/删除）
- 规则支持多条件组合筛选，用于从大量任务中快速定位目标

### 优先级算法
- 用于计算列表中的“优先级/得分”列
- 可按你的习惯调整权重与加减分规则，然后保存生效

## 数据存储与同步
- 插件设置会保存在插件存储中，并带本地缓存；正常情况下会随思源的同步机制在不同设备间保持一致。

## 常见问题
### 为什么打开后没有任务？
- 首次使用必须先在「⚙️ 设置 → 文档分组与管理」添加至少一个文档；否则会提示“请先选择要显示的文档”。
